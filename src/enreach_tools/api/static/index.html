<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dataset Viewer</title>
    <link rel="stylesheet" href="styles.css?v=6" />
    <link rel="icon" href="/favicon.ico" type="image/png" />
  </head>
  <body>
    <header class="topbar">
      <h1 class="brand">Enreach Tools</h1>
      <a class="btn logout" href="/auth/logout" title="Logout">Logout</a>
      <!-- Top-level pages navigation -->
      <nav class="tabs" id="pages" aria-label="Pages">
        <button class="tab active" data-page="home">Home</button>
        <button class="tab" data-page="zabbix">Zabbix</button>
        <button class="tab" data-page="netbox">NetBox</button>
        <button class="tab" data-page="jira">Jira</button>
        <button class="tab" data-page="confluence">Confluence</button>
        <button class="tab" data-page="chat">Chat</button>
        <button class="tab" data-page="export">Export</button>
      </nav>
    </header>

    <main class="main">
      <!-- Export Page -->
      <section class="page" id="page-export">
        <nav class="tabs" id="ds-tabs" aria-label="Datasets">
          <button class="tab" data-ds="devices">Devices</button>
          <button class="tab" data-ds="vms">VMs</button>
          <button class="tab active" data-ds="all">All</button>
        </nav>
        <div class="toolbar">
          <label class="field grow">
            <span>Search</span>
            <input id="q" type="text" placeholder="Search all columns" />
          </label>
          <button id="hideBtn" class="btn" title="Hide fields">üëÅÔ∏è‚Äçüó®Ô∏è Hide fields</button>
          <button id="resetFilters" class="btn ghost" title="Reset all column filters">Reset filters</button>
          <button id="updateBtn" class="btn" title="Run export and refresh">Update dataset</button>
          <button id="viewLogs" class="btn" title="View recent export logs">View logs</button>
          <button id="downloadCsv" class="btn" title="Download filtered CSV">Download CSV</button>
          <label class="field">
            <span>Density</span>
            <select id="density">
              <option value="comfortable" selected>Comfortable</option>
              <option value="compact">Compact</option>
            </select>
          </label>
          <button id="reload" class="btn">Refresh</button>
          <span id="summary" class="summary"></span>
        </div>
        <div class="grid root" id="grid-root">
          <div class="grid header">
            <div class="header-scroll" id="header-scroll">
              <div class="header-rows">
                <div class="header-row" id="header-row"></div>
                <div class="filter-row" id="filter-row"></div>
              </div>
            </div>
          </div>
          <div class="grid body" id="body">
            <div class="body-scroll" id="body-scroll">
              <div class="canvas" id="canvas"></div>
              <div class="rows" id="rows"></div>
            </div>
          </div>
        </div>
      </section>

      <!-- NetBox Search Page -->
      <section class="page" id="page-netbox" hidden>
        <div class="panel">
          <h2>NetBox Search</h2>
          <div class="toolbar" style="margin: 8px 0 12px">
            <label class="field grow">
              <span>Search</span>
              <input id="nb-q" type="text" placeholder="Full‚Äëtext query" />
            </label>
            <button id="nb-search" class="btn">Search</button>
            <div class="spacer"></div>
            <label class="field">
              <span>Max</span>
              <select id="nb-max">
                <option value="0">All</option>
                <option value="25">25</option>
                <option value="50" selected>50</option>
                <option value="100">100</option>
                <option value="200">200</option>
              </select>
            </label>
            <button id="nb-reset" class="btn ghost">Reset</button>
          </div>
          <div id="nb-results" class="feed empty">Not searched yet.</div>
        </div>
      </section>

      <!-- Home Page -->
      <section class="page" id="page-home" hidden>
        <div class="panel">
          <h2>Home</h2>
          <div class="toolbar" style="margin: 8px 0 12px">
            <label class="field grow">
              <span>Search</span>
              <input id="home-q" type="text" placeholder="Object name (e.g., device, vm, IP, keyword)" />
            </label>
            <button id="home-search" class="btn">Search</button>
            <div class="spacer"></div>
            <label class="field">
              <span>Zabbix</span>
              <input id="home-zlimit" type="number" min="0" value="10" style="width:80px" />
            </label>
            <label class="field">
              <span>Jira</span>
              <input id="home-jlimit" type="number" min="0" value="10" style="width:80px" />
            </label>
            <label class="field">
              <span>Confluence</span>
              <input id="home-climit" type="number" min="0" value="10" style="width:100px" />
            </label>
          </div>
          <div id="home-results" class="feed empty">Enter a search term and press Search.</div>
        </div>
      </section>

      <!-- Chat Page -->
      <section class="page" id="page-chat" hidden>
        <div class="panel">
          <h2>AI Chat (suggestions only, no direct actions)</h2>
          <p class="muted">Choose a provider and ask questions about the data. Answers may include suggested text for Jira/Confluence. Nothing is written automatically.</p>
          <div class="toolbar" style="margin: 8px 0 12px">
            <label class="field">
              <span>Provider</span>
              <select id="chat-provider">
                <option value="openai">OpenAI</option>
                <option value="openrouter">OpenRouter</option>
                <option value="claude">Claude</option>
                <option value="gemini">Gemini</option>
                <option value="other">Other</option>
              </select>
            </label>
            <label class="field">
              <span>Model</span>
              <input id="chat-model" type="text" placeholder="e.g. gpt-4o, claude-3-5, gemini-1.5" />
            </label>
            <label class="field">
              <input id="chat-include-data" type="checkbox" checked />
              <span>Use data context</span>
            </label>
            <label class="field">
              <input id="chat-stream" type="checkbox" checked />
              <span>Stream</span>
            </label>
          </div>
          <div class="chat">
            <div id="chat-log" class="chat-log"></div>
            <div class="chat-input">
              <textarea id="chat-input" rows="3" placeholder="Type your question‚Ä¶"></textarea>
              <div class="chat-actions">
                <button id="chat-send" class="btn">Ask</button>
              </div>
            </div>
          </div>
          <p class="muted">Configuration: set API keys in .env; pick a provider. Results may include suggested text for Jira tickets and Confluence pages (no auto‚Äëpublish).</p>
        </div>
      </section>

      <!-- Zabbix Page -->
      <section class="page" id="page-zabbix" hidden>
        <div class="panel panel-zbx">
          <h2 class="panel-title">Zabbix</h2>
          <div class="toolbar" style="margin: 4px 0 8px">
            <button id="zbx-refresh" class="btn-icon btn-refresh" title="Refresh" aria-label="Refresh">
              <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true">
                <!-- Dual-arrow refresh icon (simple) -->
                <path d="M8 6a8 8 0 0 1 11 5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M18 4v6h-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M16 18a8 8 0 0 1-11-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                <path d="M6 20v-6h6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              </svg>
            </button>
            <button id="zbx-ack" class="btn" title="Acknowledge selected problems">Ack</button>
            <button id="zbx-home" class="btn" title="Search selected on Home">Home Search</button>
            <a class="btn" href="https://zabbix.enreach.tech/zabbix.php" target="_blank" rel="noopener">Open Zabbix</a>
            <div class="spacer"></div>
            <label class="field">
              <input id="zbx-unack" type="checkbox" />
              <span>Show unacknowledged only</span>
            </label>
            <label class="field">
              <input id="zbx-systems" type="checkbox" checked />
              <span>Only System (+ subgroups)</span>
            </label>
            <label class="field">
              <span>Auto refresh</span>
              <select id="zbx-refresh-interval">
                <option value="0" selected>Off</option>
                <option value="30000">30s</option>
                <option value="60000">1m</option>
                <option value="120000">2m</option>
                <option value="300000">5m</option>
              </select>
            </label>
            <label class="field">
              <span>Density</span>
              <select id="zbx-density">
                <option value="comfortable" selected>Comfortable</option>
                <option value="compact">Compact</option>
              </select>
            </label>
            <span id="zbx-stats" class="summary"></span>
          </div>
          <div id="zbx-feed" class="feed empty">No Zabbix connection configured yet.</div>
        </div>
      </section>

      <!-- Zabbix Host Details Page -->
      <section class="page" id="page-zhost" hidden>
        <div class="panel">
          <h2 id="zhost-title">Host</h2>
          <div class="toolbar" style="margin: 8px 0 12px">
            <button id="zhost-back" class="btn">‚¨Ö Back to Zabbix</button>
            <a id="zhost-open-zbx" class="btn" href="#" target="_blank" rel="noopener">Open in Zabbix</a>
            <div class="spacer"></div>
            <button id="zhost-ack" class="btn" title="Acknowledge selected problems">Ack</button>
            <span id="zhost-stats" class="summary" style="margin-left: 8px;"></span>
          </div>
          <div id="zhost-info" class="feed empty">Loading‚Ä¶</div>
          <hr />
          <h3>Problems (no filters)</h3>
          <div id="zhost-problems" class="feed empty">Loading‚Ä¶</div>
        </div>
      </section>

      <!-- Jira Page -->
      <section class="page" id="page-jira" hidden>
        <div class="panel">
          <h2>Jira</h2>
          <div class="toolbar" style="margin: 8px 0 12px">
            <label class="field grow">
              <span>Search</span>
              <input id="jira-q" type="text" placeholder="Full‚Äëtext (text ~ ...)" />
            </label>
            <label class="field">
              <span>Project</span>
              <input id="jira-project" type="text" placeholder="e.g. ABC" />
            </label>
            <label class="field">
              <span>Status</span>
              <input id="jira-status" type="text" placeholder="e.g. To Do, In Progress" />
            </label>
            <label class="field">
              <span>Assignee</span>
              <input id="jira-assignee" type="text" placeholder="name/email" />
            </label>
            <label class="field">
              <span>Priority</span>
              <input id="jira-priority" type="text" placeholder="e.g. High" />
            </label>
            <label class="field">
              <span>Type</span>
              <input id="jira-type" type="text" placeholder="e.g. Bug, Task" />
            </label>
            <label class="field">
              <span>Team (Service Desk)</span>
              <input id="jira-team" type="text" value="Systems Infrastructure" placeholder="e.g. Systems Infrastructure" />
            </label>
            <label class="field">
              <span>Updated</span>
              <select id="jira-updated">
                <option value="-7d">7d</option>
                <option value="-14d">14d</option>
                <option value="-30d" selected>30d</option>
                <option value="">All</option>
              </select>
            </label>
            <label class="field">
              <input id="jira-open" type="checkbox" checked />
              <span>Open only</span>
            </label>
            <label class="field">
              <span>Max</span>
              <select id="jira-max">
                <option value="25">25</option>
                <option value="50" selected>50</option>
                <option value="100">100</option>
              </select>
            </label>
            <button id="jira-search" class="btn">Search</button>
            <button id="jira-reset" class="btn ghost">Reset</button>
          </div>
          <div id="jira-results" class="feed empty">Not searched yet or configuration missing.</div>
        </div>
      </section>

      <!-- Confluence Page -->
      <section class="page" id="page-confluence" hidden>
        <div class="panel">
          <h2>Confluence</h2>
          <div class="toolbar" style="margin: 8px 0 12px">
            <label class="field grow">
              <span>Search</span>
              <input id="conf-q" type="text" placeholder="Full‚Äëtext (text ~ ‚Ä¶)" />
            </label>
            <label class="field">
              <span>Space</span>
              <input id="conf-space" type="text" placeholder="e.g. DOCS or exact name" />
            </label>
            <label class="field">
              <span>Type</span>
              <select id="conf-type">
                <option value="page" selected>Page</option>
                <option value="blogpost">Blog post</option>
                <option value="attachment">Attachment</option>
              </select>
            </label>
            <label class="field">
              <span>Labels</span>
              <input id="conf-labels" type="text" placeholder="comma‚Äëseparated" />
            </label>
            <label class="field">
              <span>Updated</span>
              <select id="conf-updated">
                <option value="" selected>All</option>
                <option value="-7d">7d</option>
                <option value="-30d">30d</option>
                <option value="-90d">90d</option>
              </select>
            </label>
            <label class="field">
              <span>Max</span>
              <select id="conf-max">
                <option value="25">25</option>
                <option value="50" selected>50</option>
                <option value="100">100</option>
              </select>
            </label>
            <button id="conf-search" class="btn">Search</button>
            <button id="conf-reset" class="btn ghost">Reset</button>
          </div>
          <div id="conf-results" class="feed empty">Not searched yet.</div>
        </div>
      </section>
    </main>

    <!-- Hide fields panel -->
    <div id="fields-panel" class="fields-panel" hidden>
      <div class="fields-head">
        <div class="fields-title">
          <strong>Hide fields</strong>
          <div class="spacer"></div>
          <button id="fields-collapse" class="btn-icon" title="Close">‚úï</button>
        </div>
        <input id="fields-search" class="fields-search" type="text" placeholder="Find a field" />
      </div>
      <div id="fields-list" class="fields-list" role="listbox" aria-label="Columns"></div>
      <div class="fields-actions">
        <button id="hide-all" class="btn ghost">Hide all</button>
        <button id="show-all" class="btn ghost">Show all</button>
      </div>
    </div>

    <!-- Progress panel -->
    <div id="progress-panel" class="progress-panel" hidden>
      <div class="progress-head">
        <strong>Updating dataset‚Ä¶</strong>
        <div class="spacer"></div>
        <button id="progress-close" class="btn-icon" title="Close">‚úï</button>
      </div>
      <pre id="progress-log" class="progress-log"></pre>
      <!-- Manual resize handles for both corners -->
      <div id="resize-se" class="resize-handle se" title="Resize"></div>
      <div id="resize-sw" class="resize-handle sw" title="Resize"></div>
    </div>

    <script src="app.js?v=8"></script>
  </body>
  </html>
